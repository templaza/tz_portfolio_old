!function($){return $.fn.tzChosen=function(options){var selected=$(this),inputName=$(this).attr("name"),id=$(this).attr("id"),$var=$.extend({},$.fn.tzChosen.defaults,options);$.fn.tzChosen.defaults={source:[],sourceEdit:[],items:8,minLength:1,keys:null,updater:function(a){},highlighter:function(a){},matcher:function(a){}},$var.updater=function(item){return addElement(newsource.indexOf(item),item),$(this).width(25),cursource[cursource.indexOf(item)]="",options.updater&&eval(options.updater.toString().replace(/function+\s?\(\)\{/i,"").replace(/\}$/,"")),null};var cursource=$var.source?$var.source.slice(0):[],newsource=$var.source?$var.source.slice(0):[],medsource=$var.source?$var.source.slice(0):[];$(this).removeAttr("name");var _html='<div id="tz_chosen_'+id+'" class="chzn-container chzn-container-multi">';_html+='<ul class="tz_chzn-choices chzn-choices"><li class="search-field">',_html+="</li></ul></div>",$(_html).insertBefore($(this));var main=$("#tz_chosen_"+id);main.find(".search-field").append($(this)),main.find(".chzn-choices").width($(this).width());var addElement=function(a,b){var c='<li id="tz_chosen_t_'+a+'" class="search-choice">';c+="<span>"+b+"</span>",c+='<a class="search-choice-close" rel="'+a+'" href="javascript:void(0)"></a>',c+='<input type="hidden" name="'+inputName+'" value="'+b.trim()+'"/>',c+="</li>",$(c).insertBefore(main.find(".chzn-choices").find(".search-field")),selected.removeAttr("value"),selected.focus()};main.find(".chzn-choices").live("click",function(){selected.focus()}),main.find(".search-choice-close").live("click",function(){var a=$(this).attr("rel"),b=$("#tz_chosen_t_"+a);1==main.find(".search-choice").length&&selected.width("auto"),-1!=medsource.indexOf(b.find("input").attr("value"))?cursource[a]=medsource[a]:newsource.splice(a,1),b.remove()}),$(this).typeahead({source:function(a,b){b(cursource)},items:$var.items,minLength:$var.minLength,updater:$var.updater,highlighter:$var.highlighter,matcher:$var.matcher}),$var.sourceEdit&&($.each($var.sourceEdit,function(a,b){addElement(cursource.indexOf(b),b),cursource[cursource.indexOf(b)]=""}),$(this).width(25));var strKeysEqual="e.which == 13",strKeysNotEqual="e.which != 13";return $var.keys&&$var.keys.length&&$var.keys.each(function(a,b){strKeysEqual+=" || e.which - 144 =="+a.charCodeAt(0),strKeysNotEqual+=" && e.which - 144 !="+a.charCodeAt(0)}),$(this).keyup(function(e){if($("#tz_chosen_"+inputName.replace("[]","")+" > .typeahead").length||$("#tz_chosen_"+inputName.replace("[]","")).append($("#tz_chosen_"+inputName.replace("[]","")).find(".chzn-choices .typeahead")),eval(strKeysNotEqual)&&$(this).width(25+4*$(this).attr("value").length),eval(strKeysEqual)){var cval=$(this).attr("value");cval.length&&(-1==newsource.indexOf(cval)?(newsource.push(cval),addElement(newsource.length-1,cval),$(this).width(25),$(".typeahead").css({display:"none"})):$(".typeahead").css({display:"none"}))}}).keydown(function(e){if(eval(strKeysEqual)&&13!=e.which){if("none"!=$(".typeahead").css("display")){var cval=$(this).attr("value");$(".typeahead").find("li").hasClass("active")&&(cval=$(".typeahead").find("li.active").attr("data-value"),-1!=newsource.indexOf(cval)&&(addElement(cursource.indexOf(cval),cval),$(this).width(25),cursource[cursource.indexOf(cval)]=""))}e.preventDefault()}})}}(jQuery);